<!DOCTYPE HTML>
<!--
Dimension by HTML5 UP
html5up.net | @ajlkn
Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
<head>
	<title>TraVerse</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
	<link rel="stylesheet" type="text/css" href="/assets/css/main.css" />
	<!--[if lte IE 9]><link rel="stylesheet" href="/assets/css/ie9.css" /><![endif]-->
	<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
	<link rel="stylesheet" href="/assets/css/player.css">
	<noscript><link rel="stylesheet" href="/assets/css/noscript.css" /></noscript>

	<style>
		.tracklist
		{
			overflow:scroll;
			height:1050px;
			position:relative;

		}
	</style>
</head>


<body>
<script>
    window.fbAsyncInit = function() {
        FB.init({
            appId      : '1596316047096337',
            cookie     : true,
            xfbml      : true,
            version    : 'v2.10'
        });


        FB.getLoginStatus(function(response) {
			$.ajax({
				type: 'POST',
				url: 'oauth/facebook',
                contentType: 'application/json',
				dataType:'json',
				data: JSON.stringify({
					"accessToken" : response['authResponse']['accessToken'],
					"userID" : (response['authResponse']['userID'])
				}),
				success: function (msg) {

				}
			});

           /*if(response.status === 'connected') {

		       document.getElementById('status').innerHTML ='we are connected';
           } else if (response.status === 'not_authorized') {
               document.getElementById('status').innerHTML = 'we are not logged in.';
           } else {
               document.getElementById('status').innerHTML = 'you are not logged into facebook';
           }
*/
        });
	};

    (function(d, s, id){
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) {return;}
        js = d.createElement(s); js.id = id;
        js.src = "//connect.facebook.net/en_US/sdk.js";
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
</script>

<!-- Wrapper -->
<div id="status"></div>
<div id="wrapper">

	<!--div style ="margin-left:-65%"-->

	<div id="parent" class="w3-top">
		<div class="w3-bar">
			<input style ="margin-left: 15%" type = "text" name="search" placeholder="Search..."> </div>
		<div  class="fb-login-button" data-max-rows="1" data-size="medium" data-button-type="login_with" data-show-faces="false" data-auto-logout-link="true" data-use-continue-as="false"></div>

		<div>
			<a type="button" href="#songUpload"><button style="background-color:#8bc34a">Upload Song</button></a>
		</div>
		<!--div>
		<button onclick="addTrack()">Submit</button>
		</div-->


		<!-- Header -->
		<header id="header">


			<nav>
				<ul>
					<!-- <li><a href="#recent">Recent</a></li>
                        <li><a href="#friends">Friends</a></li>
                        <li><a href="#profile">Profile</a></li -->
                        <!--li><a href="#contact">Contact</a></li-->
					<!-- <li><a href="#LogIn">LogIn</a> </li> -->
					<!--<li><a href="#elements">Elements</a></li>-->

				</ul>
			</nav>

		</header>


		<div class="w3-container w3-light-green" style="top: auto" style="text-align: center">
			<h1>TraVerse through music</h1>
		</div>

		<div id="playerWrapper">
			<audio id="current_track">
				<source id="trackSource"  src="http://localhost:8080/data/audio/getFile?audioID=43036625d13e4334ac887ba2c71daedc"/>
			</audio>
			<nav id="playerNav">
				<div id="defaultBar">
					<div id="progressBar"></div>
				</div>
				<div id="buttons">
					<button type="button" id="playButton"></button>
					<button type="button" id="muteButton"></button>
					<span id="currentTime">0:00</span>
					/<span id="fullDuration">0:00</span>
				</div>
			</nav>
		</div>





<!-- Audio Section -->
<div id="child"  class="tracklist">
	<div>
		<button onclick="listTracks()">Show database tracks</button>
	</div>
	<!--div>
	<h1>track Name1</h1>
	<audio controls>
		<source src="audio/03%20Engine%2045.mp3 " type="audio/mpeg">
	</audio>
	</div>

	<div>
	<h1>track Name2</h1>
	<audio controls>
		<source src="audio/04%20Slipping%20Away.mp3 " type="audio/mpeg">
	</audio>
</div>
	<div>
	<h1>track Name3</h1>
	<audio controls>
		<source src="audio/07%20White%20Light.mp3 " type="audio/mpeg">


	</audio>
	</div>
</div-->


</div>


</div>

</div>

<!--SideBar-->
<!--  <div class="w3-sidebar w3-light-grey w3-bar-block" style="width:10%;left:0; top: 0%;">

  <div class="logo">
      <span class="icon fa-diamond"></span>
  </div>


  <a href="#" class="w3-bar-item w3-button">TraVerse</a>


  <p>A music sharing site </p>


  <a href="#" class="w3-bar-item w3-button">Playlist 1</a>
  <a href="#" class="w3-bar-item w3-button">Playlist 2</a>
  <a href="#" class="w3-bar-item w3-button">Playlist 3</a>
  <a href="#" class="w3-bar-item w3-button">Playlist 4</a>
  <a href="#" class="w3-bar-item w3-button">Playlist 5</a>
</div>
                              -->

<!-- Main -->
<div id="main">
	<article id="songUpload" style="position:fixed; bottom:0; top:10%; height:300px">
		<form action="http://localhost:8080/#" class="trackForm">
		<h2 class="major">Upload your Track</h2>

			<div class="field half first">
				<label for="name">Name</label>
				<input type="text" name="name" id="name" />
			</div>
			<div class="field half">
				<label for="thefile">Your File</label>
				<input type="file" id="thefile"  accept=".wav, .mp3">
			</div>
			<div class="field">
				<label for="message">Track Description</label>
				<textarea name="message" id="message" rows="4"></textarea>
			</div>

			<ul class="actions">
				<li><button>Submit</button></li>
				<li><input type="reset" value="Reset" /></li>
			</ul>
		</form>
	</article>
	<article id="createUsername" style="position:fixed; bottom:0; top:0; height:300px">
		<form action="http://localhost:8080/#" class="usernameForm">
			Please create a username:<br>
			<input type="text" name="username" id="username"><br>
			<ul class="actions">
				<li><button>Create Name</button></li>
			</ul>
		</form>
	</article>
	<!-- Footer -->
	<footer id="footer">
		<p class="copyright">&copy; Untitled. Design: <a href="https://html5up.net">HTML5 UP</a>.</p>
	</footer>

</div>

<!-- BG -->
<div id="bg"></div>

<!-- Scripts -->

<script src="/assets/js/jquery.min.js"></script>
<script src="/assets/js/skel.min.js"></script>
<script src="/assets/js/util.js"></script>
<script src="/assets/js/main.js"></script>
<script src="/assets/js/jquery-3.2.1.js"></script>
<script src="/assets/js/forAuth.js"></script>

<script>
    document.getElementById('get_file').onclick = function() {
        document.getElementById('my_file').click();
    };
</script>
<script>





        /*var trackName = document.createElement('div');
        trackName.innerHTML = "fresh uploadddddddd";
        document.getElementById("child").appendChild(trackName);
        var trackAudio = document.createElement('audio');
        trackAudio.getAsFile();
		document.getElementById("child").appendChild(trackAudio);
		*/

    $(function () {
        $('#main').on('submit', '.trackForm', function(event){
            event.preventDefault();
			console.log("hello");


            var ownerID;
            var grabID = {
                "url": "/oauth/getUser",
                "method": "GET",
				"dataType" : 'json',
				async : false
            };
            $.ajax(grabID).done(function (response) {
                ownerID = (response['response']);
                console.log(ownerID);

            });






                var thefile = document.getElementById('thefile').files[0];
                var form = new FormData();
                form.append("file", thefile);
                form.append("name", document.getElementById('name').value);
                console.log(document.getElementById('name').value);
                form.append("description", document.getElementById('message').value);
                console.log(document.getElementById('message').value);
                form.append("ownerID", ownerID);
            	console.log(ownerID);


            var settings = {
                "async": false,
                "crossDomain": false,
                "url": '/data/audio/create',
                "method": "POST",
                "headers": {
                    "cache-control": "no-cache"

                },
                "processData": false,
                "contentType": false,
                "mimeType": "multipart/form-data",
                "data": form
            };

            $.ajax(settings).done(function (response) {





            });
        })
    });




</script>
<script>
    var audioID;

	window.onload = function listTracks() {

      $.ajax({
            type: 'GET',
            url: '/data/audio/list',
			dataType:'json',
		   global:false,
		   async:false,
		  success: function(response){

              var count = 0;
              for (var key=0; key <10; key++) {
                  audioID =JSON.stringify(response['results'][key]['audio_id']);
                  audioID=audioID.replace(/^"(.*)"$/, '$1');//this line removes quotes from the audio_id string
                  var newdiv = document.createElement('div');
                  $("newdiv").data("audioID",audioID);
                  var storedID = $("newdiv").data("audioID");
                  //console.log(JSON.stringify(response['results'][key]));
                  var playButton = document.createElement('button');
                  playButton.setAttribute("class", "trackElement");
                  playButton.setAttribute("id", audioID);
                  playButton.setAttribute('onclick','sendToPlayer(this.id)');
                  var artistText = document.createElement('h1');
                  artistText.innerText = "Artist Name Here -";
                  var trackNameText = document.createElement('h1');
                  trackNameText.innerText = JSON.stringify(response['results'][key]['audio_name']);

                  newdiv.appendChild(artistText);
                  newdiv.appendChild(trackNameText);
                  newdiv.appendChild(playButton);
                  document.getElementById("child").appendChild(newdiv);


              }
		  }


        });


           // var length = Object.keys(listAsString).length;
           // console.log(length);




	}

    $(function () {
    $('#main').on('submit', '.usernameForm', function(event){
        event.preventDefault();
        console.log('check');
		$.ajax({
            type: 'GET',
            url: '/data/user/{id}/setUsername',
            dataType:'string',
			data: {
                "username": document.getElementById('username')
			}
		})
	})
	});


    function sendToPlayer (trackID) {

            event.preventDefault();

            console.log('arewethereyet');
            document.getElementById("trackSource").setAttribute("src","http://localhost:8080/data/audio/getFile?audioID="+trackID);
        document.getElementById("current_track").pause();
        document.getElementById("current_track").load();
        document.getElementById("current_track").play();


	}

</script>
<script type="text/javascript" src="/assets/js/controls.js"></script>
</body>
</html>